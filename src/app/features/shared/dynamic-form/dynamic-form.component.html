<p-card>
  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="dynamic-form">
    @for (field of fields(); track field.name) {
      <div class="field-wrapper">
        <label [for]="field.name" class="field-label">
          {{ field.label }}
          @if (field.type === 'rating') {
            <span class="rating-value">({{ getRatingDisplay(field.name, 10) }})</span>
          }
          @if (isFieldRequired(field)) {
            <span class="required-indicator">*</span>
          }
        </label>

        @if (field.type === 'text') {
          <input
            pInputText
            [id]="field.name"
            [formControlName]="field.name"
            [placeholder]="field.placeholder"
            [class.ng-invalid]="isFieldInvalid(field.name)"
            [class.ng-dirty]="isFieldDirty(field.name)"
            class="w-full"
          />
          @if (isFieldInvalid(field.name) && isFieldDirty(field.name)) {
            <small class="p-error">{{ getFieldError(field.name) }}</small>
          }
        } @else if (field.type === 'textarea') {
          <textarea
            pTextarea
            [id]="field.name"
            [formControlName]="field.name"
            [placeholder]="field.placeholder"
            [rows]="4"
            [class.ng-invalid]="isFieldInvalid(field.name)"
            [class.ng-dirty]="isFieldDirty(field.name)"
            class="w-full"
          ></textarea>
          @if (isFieldInvalid(field.name) && isFieldDirty(field.name)) {
            <small class="p-error">{{ getFieldError(field.name) }}</small>
          }
        } @else if (field.type === 'number') {
          <p-inputNumber
            [id]="field.name"
            [formControlName]="field.name"
            [placeholder]="field.placeholder"
            [min]="0"
            [max]="10"
            [showButtons]="true"
            [class.ng-invalid]="isFieldInvalid(field.name)"
            [class.ng-dirty]="isFieldDirty(field.name)"
            styleClass="w-full"
          ></p-inputNumber>
          @if (isFieldInvalid(field.name) && isFieldDirty(field.name)) {
            <small class="p-error">{{ getFieldError(field.name) }}</small>
          }
        } @else if (field.type === 'date') {
          <p-datePicker
            [id]="field.name"
            [formControlName]="field.name"
            [placeholder]="field.placeholder"
            dateFormat="yy-mm-dd"
            [showIcon]="true"
            [class.ng-invalid]="isFieldInvalid(field.name)"
            [class.ng-dirty]="isFieldDirty(field.name)"
            styleClass="w-full"
          ></p-datePicker>
          @if (isFieldInvalid(field.name) && isFieldDirty(field.name)) {
            <small class="p-error">{{ getFieldError(field.name) }}</small>
          }
        } @else if (field.type === 'select') {
          <p-select
            [id]="field.name"
            [formControlName]="field.name"
            [options]="field.options ?? []"
            optionLabel="label"
            optionValue="value"
            [placeholder]="field.placeholder || 'Wybierz opcjÄ™'"
            [class.ng-invalid]="isFieldInvalid(field.name)"
            [class.ng-dirty]="isFieldDirty(field.name)"
            styleClass="w-full"
          ></p-select>
          @if (isFieldInvalid(field.name) && isFieldDirty(field.name)) {
            <small class="p-error">{{ getFieldError(field.name) }}</small>
          }
        } @else if (field.type === 'rating') {
          <p-rating
            [id]="field.name"
            [formControlName]="field.name"
            [stars]="10"
            [invalid]="isFieldInvalid(field.name)"
          ></p-rating>
          @if (isFieldInvalid(field.name) && isFieldDirty(field.name)) {
            <small class="p-error">{{ getFieldError(field.name) }}</small>
          }
        }
      </div>
    }

    <div class="form-actions">
      <p-button
        type="submit"
        label="Zapisz"
        icon="pi pi-save"
        [disabled]="form.invalid"
      ></p-button>
    </div>
  </form>
</p-card>


